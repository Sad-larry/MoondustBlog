# MBlog接口文档

## ==后台接口==

### 0 登录管理

#### 0.1 管理员登录

##### 0.1.1 管理员登录

0.1.1.1 功能分析

​	用户输入管理员账号登录后台。

​	当用户成功登录时，应该查询该用户所对应的角色（一个用户对应一个角色），通过该角色查询菜单，然后把菜单数据返回到响应格式中

- [ ] 9/27完成，但是，很乱很乱，有时间优化一下，用mapper文件比写了无数个queryWrapper好
- [ ] birthday数据有问题，多了很多东西

0.1.1.2 接口设计

| 请求方式 | 请求路径     |
| -------- | ------------ |
| POST     | /admin/login |

请求体：

```json
{
    "username": "md",
    "password": 1
}
```

响应格式：

~~~json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "token": "...",
        "userInfo": {
            "nickName": "moondust",
            "mobile": "151...",
            "email": "md@md.md",
            "avatar": "http://...",
            "intro": "my blog",
            "birthday": "2022-9-21"
        },
        "menuList": [
            {
                "id": 100,
                "menuName": "首页",
                "url": "/",
                "component": "/home/Home.vue",
                "icon": null,
                "subMenuList": [
                    {
                        "id": 0,
                        "menuName": "",
                        "url": "/",
                        "component": "/.vue",
                        "icon": null,
                        "subMenuList": null
                    }
                ]
            }
        ]
    }
}
~~~

### 1 文章管理

#### 1.1 发表文章

##### 1.1.1 发表文章

1.1.1.1 功能分析

​	字段：文章标题，文章内容，文章摘要，所属分类，标签，缩略图，是否置顶，文章状态，是否允许评论。前期这些东西需要手动添加。图片就存在七牛云上面，数据库保存的是图片访问地址。

​	当添加标签的时候，需要同时在标签表中添加对应的数据。

​	考虑到发表文章只能是管理员发的，毕竟是我的个人博客。但是查看文章分管理员和普通用户，能看到的内容都不一样（状态），所以在查看方法调用的时候，加个身份区分字段。

​	分类以及标签需要提前查出来。

​	分类设置上线

- [ ] 文章摘要可以截取文章头内容一段，然后加...
- [ ] 后期，缩略图可以不用手动添加，希望可以自动识别，提取图片
- [x] 当有人不从前端传入数据咋办？再判断一下当前添加的分类和标签是否存在数据库吗？

1.1.1.2 接口设计

前提：

- category需要提前查询
- tag需要提前查询

| 请求方式 | 请求地址       |
| -------- | -------------- |
| POST     | /admin/article |

请求体：

~~~json
{
    "title": "文章标题",
    "content": "文章内容",
    "summary": "文章摘要",
    "categoryId": 1,
    "tagList": [
        1,
        2
    ],
    "thumbnail": "https://..",
    "isTop": "0",
    "isComment": "1",
    "status": "1"
}
~~~

响应格式：

~~~json
{
    "code": 200,
    "msg": "操作成功"
}
~~~

#### 1.2 文章列表

##### 1.2.1 查询所有文章

1.2.1.1 功能分析

​	文章列表里面，是对查询出来的所有文章的删改，前台和后台查询出来的数据格式是不一样的，后台可以修改文章在前台显示的参数，例如是否置顶，是否允许评论。

1.2.1.2 接口设计

前提：

- uesrname需要以user_id查出来
- 需要去tag表中查询当前文章所拥有的标签

| 请求方式 | 请求路径            |
| -------- | ------------------- |
| GET      | /admin/article/list |

请求参数：

- （非必须）pageNum：页码，默认为1
- （非必须）pageSize：每页条数，默认为10
- （非必须）fuzzyField：文章标题和文章摘要，模糊查询，也可以查询特定的文章，需要输入`#id=1`就可以查询id为1的文章啦。不要这个指令了。

响应格式：

~~~json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "records ": [
            {
                "id": 1,
                "userId": 1,
                "username": "admin",
                "title": "文章标题",
                "content": "文章内容",
                "summary": "文章摘要",
                "categoryVo": {
                    "id": 1,
                    "categoryName": "Java"
                },
                "tagListVo": [
                    {
                        "id": 1,
                        "tagName": "Java"
                    },
                ],
                "thumbnail": "https://..",
                "isTop": "0",
                "status": "1",
                "viewCount": 1,
                "isComment": "1",
                "commentCount": 0,
                "starCount": 0,
                "createTime": "2022-9-22 19:24:00",
                "updateTime": "2022-9-22 19:24:00"
            }
        ],
        "total": 1,
        "current": 1,
        "size": 10
    }
}
~~~

##### 1.2.2 修改文章

1.2.2.1 功能分析

​	文章列表中有文章的所有信息，包括文章的id，当我们想查看文章详细的时候，点击详情则新建页面展示文章；当我们在文章列表或文章详情中点击修改文章的时候，vue负责将该文章的id传到编辑文章的页面。

1.2.2.2 接口设计

​	跟发表文章差不多，只不过多了一个id字段，但是如果有人跳过前端，在他的文章上面手动添加id字段怎么办，这样不就修改其他人的文章了吗？那我修改之前，看看文章的user_id跟当前的user_id是不是一样的，如果是的话，那他自己修改自己的文章，很合理吧。，发表文章肯定会把自己的user_id带上，id伪造，user_id不一样，还是不能修改。

| 请求方式 | 请求路径       |
| -------- | -------------- |
| PUT      | /admin/article |

请求体：

~~~json
{
    "id": 1,
    "1.1.1.2请求体"
}
~~~

响应格式：

~~~json
{
    "code": 200,
    "msg": "操作成功"
}
~~~

##### 1.2.3 删除文章

1.2.3.1 功能分析

​	这个简单，不过删除文章的时候记得把tag表中的字段删除。但是我想，能不能不删除，毕竟可能删错了，那我可以把**status字段设置为-1**，表示删除确认，然后弄个定时任务，负责统一时间段，真正的删除掉status为-1的文章，不过需要改数据库，那我写到这的时候再去改，不，现在就去。..好了。那定时处理的时候，再把`t_tag`表中该文章字段删除。

1.2.3.2 接口设计

| 请求方式 | 请求路径            |
| -------- | ------------------- |
| DELETE   | /admin/article/{id} |

请求参数：

- id：@PathVariable文章id

响应格式：

~~~json
{
    "code": 200,
    "msg": "操作成功"
}
~~~

##### 1.2.4 修改文章分类和标签

1.2.4.1 功能分析

实现修改文章的接口的时候，突然想到，如果我单独修改文章分类，单独修改文章标签，我就不用把整个文章都修改掉了。

1.2.4.2 接口设计

| 请求方式 | 请求地址                      |
| -------- | ----------------------------- |
| PUT      | /admin/article/updateCategory |
| PUT      | /admin/article/updateTags     |

请求体：

~~~json
{
    "id": 1,
    "categoryId": 1
}
~~~

~~~json
{
    "id": 1,
    "tagList": [
        1,
        2
    ]
}
~~~

响应格式：

~~~json
{
    "code": 200,
    "msg": "操作成功"
}
~~~

#### 1.3 标签列表

##### 1.3.1 查询所有标签

1.3.1.1 功能分析

​	查询所有的标签

1.3.1.2 接口设计

| 请求方式 | 请求路径        |
| -------- | --------------- |
| GET      | /admin/tag/list |

请求参数：

- （非必须）pageNum：页码，默认为1
- （非必须）pageSize：每页条数，默认为10
- （非必须）fuzzyField：标签名和标签描述的模糊查询，也可以查询特定的标签，需要输入`#id=1`就可以查询id为1的标签啦。

响应格式：

~~~json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "records": [
            {
                "id": 1,
                "tagName": "Java",
                "description": "java",
                "status": "1",
                "createTime": "2022-9-22 19:24:00"
            }
        ],
        "total": 1,
        "current": 1,
        "size": 10
    }
}
~~~

##### 1.3.2 修改标签

1.3.2.1 功能分析

​	通过id修改

1.3.2.2 接口设计

| 请求方式 | 请求地址   |
| -------- | ---------- |
| PUT      | /admin/tag |

请求体：

~~~json
{
    "id": 1,
    "tagName": "Java",
    "description": "java",
    "status": "1"
}
~~~

响应格式：

~~~~json
{
	"code":200,
	"msg":"操作成功"
}
~~~~

##### 1.3.3 删除标签

1.3.3.1 功能分析

​	没有分析，id删除。

​	后知后觉，后知后觉阿，你标签删除了，文章引用的标签怎么办，毕竟没有了标签，显示什么，文章通过id查询出的标签怎么办。正确办法应该是，在`t_article_tag`表中查询出当前有tag_id的文章article_id，然后返回这些文章id，告知前端，这些文章正使用该tag。

​	tag删除为状态删除，status设置为'0'

- [x] 如果一定要删除的话，可以通过某些手段将(article_id,tag_id)中的tag_id设置为其他字段id，例如**其他标签**，如果该文章有其他标签，那么可以直接删除掉，否则修改为其他（解决1.3.4.1）

1.3.3.2 接口设计

| 请求方式 | 请求路径        |
| -------- | --------------- |
| DELETE   | /admin/tag/{id} |

请求参数：

- id：@PathVariable标签id

响应格式：

~~~~json
{
	"code": 200,
	"msg":"操作成功"
}
~~~~

##### 1.3.4 新增标签

1.3.4.1 功能分析

​	我可以在这里删除不能删的标签诶，只有认证为管理员，然后输入指定代码就可以删除了。

​	在新增界面，输入`*id=1`，就可以实现1.3.3.1中待实现的功能了。article_tag表查出使用了id为1的文章，例如1，2，3，然后在`t_article_tag`表中插入(1, 2)，(2, 2)，(3, 2)，假如括号中后面的2为其他标签，操作完成后，删除掉(1, 1)，(2, 1)，(3, 1)

​	新增的话，如果新增的标签跟删除的标签是一样的话就将删除的标签状态设置为1

1.3.4.2 接口设计

| 请求方式 | 请求地址   |
| -------- | ---------- |
| POST     | /admin/tag |

请求体：

~~~json
{
    "tagName": "@id=1",
    "description": ""
}
~~~

响应格式：

~~~~json
{
	"code":200,
	"msg":"操作成功"
}
~~~~

#### 1.4 分类列表

##### 1.4.1 查询所有分类

##### 1.4.2 修改分类

##### 1.4.3 删除分类

##### 1.4.4 新增分类

​	分类列表跟标签列表差不多，请求路径不一样罢了，删除分类的时候，也需要查询所有文章，然后返回使用了该分类的文章并表示不能删除。

- [x] 如果硬要删除的话，就修改所有文章的category_id为其他分类的id，然后再删除（解决1.3.4.1，因为每个文章都只有一个分类，所以当要删除该分类的时候，不需要判断有没有其他分类，除非他就是其他分类，哈哈哈，去T喵的）

| 请求方式 | 请求路径             |
| -------- | -------------------- |
| GET      | /admin/category/list |
| PUT      | /admin/category      |
| DELETE   | /admin/category/{id} |
| POST     | /admin/category      |

### 2 用户管理

#### 2.1 用户列表

##### 2.1.1 用户列表

2.1.1.1 功能分析

​	可以进行模糊查询，例如输入`%username=md`，就可以查询出用户名含有md的用户，可用字段：username、mobile、status，当为`#id=1`时，就查询出id为1的用户，非模糊查询。

​	应该查出来该用户有什么角色。

2.1.1.2 接口设计

| 请求方式 | 请求路径         |
| -------- | ---------------- |
| GET      | /admin/user/list |

请求参数：

- （非必须）pageNum：页码，默认为1
- （非必须）pageSize：每页条数，默认为10
- （非必须）fuzzyField：模糊查询及精准查询字段

响应体：

~~~json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "records": [
            {
                "id": 1,
                "userName": "md",
                "nickName": "昵称",
                "mobile": "151",
                "email": "1@1.1",
                "avatar": "https://..",
                "birthday": "2022-9-21",
                "status": 1,
                "updateTime": "2022-9-21 19:24:00",
                "roles": [
                    "管理员"
                ]
            }
        ],
        "total": 1,
        "current": 1,
        "size": 10
    }
}
~~~

##### 2.1.2 修改用户

2.1.2.1 功能分析

​	因为角色表不常修改，数据量小，而且还经常查询，所以我们可以把角色表数据放入缓存中，查询用户的时候，用户角色就从缓存中读取，只有修改角色表数据，才可能重新存入缓存。

​	修改用户的时候，用户列表中有用户的所有信息，根据id修改就行。

2.1.2.1 接口设计

| 请求方式 | 请求路径    |
| -------- | ----------- |
| PUT      | /admin/user |

请求体：

~~~json
{
    "id": 1,
    "nickName": "昵称",
    "mobile": "151",
    "email": "1@1.1",
    "avatar": "https://..",
    "intro": "hhh",
    "status": 1,
    "roleIds": [
        2,
        3
    ]
}
~~~

响应格式：

```JSON
{
    "code": 200,
    "msg": "操作成功"
}
```

##### 2.1.3 删除用户

2.1.3.1 功能分析

​	通过id删除某个用户，只是将账号状态设置为0，能删管理员吗？

2.1.3.2 接口设计

| 请求方式 | 请求路径         |
| -------- | ---------------- |
| DELETE   | /admin/user/{id} |

请求参数：

- id：@PathVariable用户id

响应格式：

~~~~json
{
	"code": 200,
	"msg":"操作成功"
}
~~~~

##### 2.1.4 新增用户

2.1.4.1 功能分析

​	我觉得这个接口有点鸡肋，要不要写呢

​	新增用户得先判断用户名，手机号，邮箱是否已经被占用了，然后新增用户直接关联角色

- [ ] 密码需要加密存储

2.1.4.2 接口设计

| 请求方式 | 请求路径    |
| -------- | ----------- |
| POST     | /admin/user |

请求体：

~~~json
{
    "userName": "test",
    "nickName":"test",
    "password": "1234343",
    "phonenumber": "188..",
    "email": "2@2.2",
    "avatar": "https://..",
    "birthday": "2022-9-21",
    "intro": "iii",
    "roleIds":[
        "2"
    ]
}
~~~

响应格式：

~~~~json
{
	"code":200,
	"msg":"操作成功"
}
~~~~

#### 2.2 用户评论

##### 2.2.1 评论列表

2.2.1.1 功能分析

​	用户评论有二级列表，所以在前台需要整理成树形结构，但是后台查看评论是不需要顺序的。到后面，我想根据某个字段查询评论数据，比如根据文章id，评论人id查询。

2.2.1.2 接口设计

| 请求方式 | 请求地址            |
| -------- | ------------------- |
| GET      | /admin/comment/list |

请求参数：

- （非必须）pageNum：页码，默认为1
- （非必须）pageSize：每页条数，默认为10

响应格式：

~~~json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "records": [
            {
                "id": 1,
                "articleId": 1,
                "userId": 1,
                "pid": 0,
                "content": "??",
                "avatar": "https://..",
                "nickname": "md",
                "support": 0,
                "oppose": 1,
                "status": 1,
                "createTime": "2022-9-22 19:30:00"
            }
        ],
        "total": 1,
        "current": 1,
        "size": 10
    }
}
~~~

##### 2.2.2 修改评论

2.2.2.1 功能分析

​	我不可能去修改别人的内容吧，所以这里我只能修改评论状态，例如违规评论。

2.2.2.2 接口设计

| 请求方式 | 请求路径       |
| -------- | -------------- |
| PUT      | /admin/comment |

请求体：

~~~json
{
    "id": 1,
    "status": 0
}
~~~

响应格式：

~~~~json
{
	"code":200,
	"msg":"操作成功"
}
~~~~

##### 2.2.3 删除评论

2.2.3.1 功能设计

​	对于审核或者违规的评论，给予删除操作

2.2.3.2 接口设计

| 请求方式 | 请求路径            |
| -------- | ------------------- |
| DELETE   | /admin/comment/{id} |

请求参数：

- id：@PathVariable评论id

响应格式：

~~~~json
{
	"code": 200,
	"msg":"操作成功"
}
~~~~

### 3 权限管理

#### 3.1 菜单列表

##### 3.1.1 菜单列表

3.1.1.1 功能分析

​	获取菜单列表，注意渲染前端的时候，要分清层级关系，子菜单在父级菜单里面，所以在服务器拿到所有菜单数据的时候，需要将他们按顺序排列下来。

3.1.1.2 接口设计

| 请求方式 | 请求路径         |
| -------- | ---------------- |
| GET      | /admin/menu/list |

请求参数：

- （非必须）pageNum：页码，默认为1
- （非必须）pageSize：每页条数，默认为10

响应体：

~~~json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "records": [
            {
                "id": 1,
                "menuName": "首页",
                "pid": 0,
                "url": "/",
                "component": "/home/Home.vue",
                "icon": "ico",
                "status": "1",
                "createTime": "2022-9-22"
            }
        ],
        "total": 1,
        "current": 1,
        "size": 10
    }
}
~~~

##### 3.1.2 修改菜单

3.1.2.1 功能分析

​	修改菜单信息，父级菜单id不能修改，不然会乱掉，要修改也只能删掉重新新增一个。

3.1.2.2 接口设计

| 请求方式 | 请求路径    |
| -------- | ----------- |
| PUT      | /admin/menu |

请求体：

~~~json
{
    "id": 1,
    "menuName": "1",
    "url": "/",
    "component": "/vue",
    "icon": "ico",
    "status": "1"
}
~~~

响应体：

~~~json
{
    "code": 200,
    "msg": "操作成功"
}
~~~

##### 3.1.3 删除菜单

3.1.3.1 功能分析

​	如果要删除该菜单，其子菜单也应该被删除

3.1.3.2 接口设计

| 请求方式 | 请求路径         |
| -------- | ---------------- |
| DELETE   | /admin/menu/{id} |

请求参数：

- id：@PathVariable菜单id

响应格式：

~~~~json
{
	"code": 200,
	"msg":"操作成功"
}
~~~~

##### 3.1.4 新增菜单

3.1.4.1 功能分析

​	可以分2个地方新增，1、在菜单列表中新增，这时候需要手动选择新增父菜单还是子菜单，2、在父菜单中新增，只是新增子菜单。不论何种方式，这都是前端需要做的事

3.1.4.2 接口设计

| 请求方式 | 请求路径    |
| -------- | ----------- |
| POST     | /admin/menu |

请求体：

~~~json
{
    "menuName": "1",
    "pid": 0,
    "url": "/",
    "component": "/vue",
    "icon": "ico"
}
~~~

响应体：

~~~json
{
    "code": 200,
    "msg": "操作成功"
}
~~~

#### 3.2 资源列表

##### 3.2.1 资源列表

##### 3.2.2 修改资源

##### 3.2.3 删除资源

##### 3.2.4 新增资源

​	这里的资源就是对应接口，访问的接口有哪些，但是还没写完文档，还不清楚有哪些接口，所以先暂时放一块。

​	对于接口来说，这个跟菜单列表差不多

| 请求方式 | 请求路径             |
| -------- | -------------------- |
| GET      | /admin/resource/list |
| PUT      | /admin/resource      |
| DELETE   | /admin/resource/{id} |
| POST     | /admin/resource      |

#### 3.3 角色列表

##### 3.3.1 角色列表

3.3.1.1 功能分析

​	要查询角色信息，也同时把他所对应的资源，菜单权限查询出来。

- [ ] 这样写访问数据库数据量太大了，刚开始只查询有哪些角色，如果用户点击角色对应的资源菜单，那么再去查询一下该角色对应的权限

3.3.1.2 接口设计

| 请求方式 | 请求路径         |
| -------- | ---------------- |
| GET      | /admin/role/list |

请求参数：

- （非必须）pageNum：页码，默认为1
- （非必须）pageSize：每页条数，默认为10

响应体：

~~~json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "records": [
            {
                "id": 1,
                "roleName": "管理员",
                "description": "admin",
                "status": 1,
                "menuList": [
                    100,
                    200,
                    201
                ],
                "resourceList": [
                    1
                ]
            }
        ],
        "total": 1,
        "current": 1,
        "size": 10
    }
}
~~~

##### 3.3.2 修改角色

3.3.2.1 功能分析

​	当一个角色被创建时，他所对应的除资源，菜单权限外，都已经定死了，除非删除角色，否则不能修改其他信息。

3.3.2.2 接口设计

| 请求方式 | 请求路径    |
| -------- | ----------- |
| PUT      | /admin/role |

请求体：

~~~~json
{
    "id": 1,
    "roleName": "管理员",
    "description": "admin",
    "status": 1,
    "menuIds":[
        100,
        200,
        201
    ],
    "resourceIds": [
        1
    ]
}
~~~~

响应格式：

~~~~json
{
	"code":200,
	"msg":"操作成功"
}
~~~~

##### 3.3.3 删除角色

3.3.3.1 功能分析

​	删除固定的某个角色，当删除某个角色的时候，应该将状态设置为0

3.3.3.2 接口设计

| 请求方式 | 请求路径         |
| -------- | ---------------- |
| DELETE   | /admin/role/{id} |

请求参数：

- id：@PathVariable角色id


响应格式：

~~~~json
{
	"code":200,
	"msg":"操作成功"
}
~~~~

##### 3.3.4 新增角色

3.3.4.1 功能分析

​	新增角色时，默认没有权限，需要手动添加，

当我们选择菜单权限某一项时，资源管理的权限也会同时选择，当然，这又是前端所需要干的事。

3.3.4.2 接口设计

| 请求方式 | 请求路径    |
| -------- | ----------- |
| POST     | /admin/role |

请求体：

~~~json
{
    "roleName": "test",
    "description": "test",
    "menuIds":[
        100,
        200,
        201
    ],
    "resourceIds": [
        1
    ]
}
~~~



### 4 资源管理

#### 4.1 定时任务

​	还不会。。。先放着

#### 4.2 关于我

4.2.1.1 功能分析

​	这一块是写死的数据，我应该在服务端写好一些文件，请求这个路径的时候，把文件中的数据，以一个对象的格式返回

​	一定要写在服务器上吗？为什么不写在前端，专门写一个组件用来展示个人数据呢

4.2.1.2 接口设计

| 请求方式 | 请求路径              |
| -------- | --------------------- |
| GET      | /admin/system/aboutme |

请求参数：无

响应格式：

~~~json
{
    "author": "Moondust",
    "age": 22,
    "dream": "俺没有(不可能的，但是有也不会实现的，我的特殊体质)"
}
~~~



## ==前台接口==

### 1 用户接口

#### 1.1 登录功能

##### 1.1.1 登录分析及展望

​	用户只需要通过用户名，密码就可以登录，前期项目没加权限认证，密码为明文存储。后期整合SpringSecurity后就去修改密码。

- [ ] 新加功能：用户可以选择**账号密码登录**，不局限于用户名密码登录，还可以**验证码登录**，这时候就需要短信服务了

##### 1.1.2 接口设计

| 请求方式 | 请求路径        |
| -------- | --------------- |
| POST     | /api/user/login |

请求体：

```json
{
    "username": "md",
    "password": 1
}
```

响应格式：

~~~json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "token": "...",
        "userInfo": {
            "nickname": "moondust",
            "mobile": "151...",
            "email": "md@md.md",
            "avatar": "http://...",
            "intro": "my blog",
            "birthday": "2022-9-21"
        }
    }
}
~~~

#### 1.2 注册功能

