<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="work.moonzs.mapper.RoleMapper">
    <select id="selectUserRole" resultType="java.lang.String">
        SELECT r.`code`
        FROM t_role r
                 LEFT JOIN (SELECT id, status, role_id FROM t_user) u ON u.`role_id` = r.`id`
        WHERE u.`status` = 1
          AND u.`id` = #{userId};
    </select>
    <select id="queryByRoleId" resultType="work.moonzs.domain.vo.sys.SysPermissionVO">
        SELECT DISTINCT m.`id`, m.`parent_id`, m.`title`, m.`url`, m.`perms`, m.`create_time`
        FROM t_menu m
        LEFT JOIN t_role_menu rm ON rm.menu_id = m.id
        LEFT JOIN t_role r ON r.id = rm.role_id
        WHERE m.`type` IN ('M', 'F')
        <if test="roleId != null">
            AND r.`id` = #{roleId}
        </if>
        ORDER BY m.`id`, m.`parent_id`
    </select>
    <select id="queryIdByRoleId" resultType="java.lang.Long">
        SELECT DISTINCT rm.`menu_id`
        FROM t_role_menu rm
                 LEFT JOIN t_role r ON r.id = rm.role_id
                 LEFT JOIN (SELECT id, type FROM t_menu) m ON m.`id` = rm.`menu_id`
        WHERE r.`id` = #{roleId}
          AND m.`type` IN ('F')
        ORDER BY rm.`menu_id`
    </select>
</mapper>