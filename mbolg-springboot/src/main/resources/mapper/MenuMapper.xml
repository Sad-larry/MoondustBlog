<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="work.moonzs.mapper.MenuMapper">
    <!--TODO 删除-查询用户菜单-->
    <select id="selectUserMenus" resultType="work.moonzs.domain.entity.Menu">
        select m.`id`, m.`menu_name`, m.`pid`, m.`path`, m.`component`, m.`icon`
        from t_user u
                 left join t_user_role ur on ur.`user_id` = u.`id`
                 left join t_role_menu rm on rm.`role_id` = ur.`role_id`
                 left join t_menu m on m.`id` = rm.`menu_id`
        where u.`id` = #{userId};
    </select>
    <select id="selectMenuTreeByUserId" resultType="work.moonzs.domain.entity.Menu">
        select distinct m.`id`,
                        m.`menu_name`,
                        m.`pid`,
                        m.`order_num`,
                        m.`path`,
                        m.`component`,
                        m.`query`,
                        m.`is_cache`,
                        m.`menu_type`,
                        m.`status`,
                        m.`perms`,
                        m.`icon`,
                        m.`create_time`
        from t_menu m
                 left join t_role_menu rm on m.`id` = rm.`menu_id`
                 left join t_user_role ur on rm.`role_id` = ur.`role_id`
                 left join t_role r on ur.`role_id` = r.`id`
                 left join t_user u on ur.`user_id` = u.`id`
        where u.`id` = #{userId}
          and m.`menu_type` in ('M', 'C')
          and m.`status` = 1
          AND r.`status` = 1
        order by m.`pid`, m.`order_num`
    </select>
    <select id="selectUserPerms" resultType="java.lang.String">
        SELECT DISTINCT m.`perms`
        FROM t_menu m
                 LEFT JOIN t_role_menu rm ON m.`id` = rm.`menu_id`
                 LEFT JOIN t_user_role ur ON rm.`role_id` = ur.`role_id`
                 LEFT JOIN t_role r ON ur.`role_id` = r.`id`
        WHERE ur.`user_id` = #{userId}
          AND m.`status` = 1
          AND r.`status` = 1;
    </select>
</mapper>